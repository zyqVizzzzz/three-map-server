(this["webpackJsonpthree-indoor-map"]=this["webpackJsonpthree-indoor-map"]||[]).push([[0],{16:function(e,t,n){e.exports=n(24)},23:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t),n.d(t,"store",(function(){return q}));var r=n(2),o=n.n(r),a=n(11),i=n.n(a),s=n(13),l=n(7);function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"set scene":return Object(l.a)(Object(l.a)({},e),{},{Scene:t.scene});case"set orbit":return Object(l.a)(Object(l.a)({},e),{},{Orbit:t.orbit});default:return e}}var u=n(12),h=n(0);var d={scene:new h.q,camera:new h.n(25,window.innerWidth/window.innerHeight,.1,2e3),renderer:new h.x({antialias:!0}),orbit:null},f=Object(u.a)(),p=f.StoreContext,v=(f.useDispatch,f.useMappedState),b=n(3),g=n(4),w=n(6),m=n(5),y=function(){function e(){Object(b.a)(this,e),this.building=new h.j,this.floors=[],this.root=new h.m,this.jsonData=void 0,this.FrontAngle=0,this._curFloorId=0}return Object(g.a)(e,[{key:"getBuildingId",value:function(){var e=this.jsonData.data.building.Mall;return e||-1}},{key:"getDefaultFloorId",value:function(){return this.jsonData.data.building.DefaultFloor}},{key:"getFloorNum",value:function(){return this.jsonData.data.Floors.length}},{key:"getFloor",value:function(e){for(var t=0;t<this.floors.length;t++)if(this.floors[t].userData._id===e)return this.floors[t];return null}},{key:"getFloorByName",value:function(e){for(var t=0;t<this.floors.length;t++)if(this.floors[t].userData.Name===e)return this.floors[t];return null}},{key:"getCurFloor",value:function(){return this.getFloor(this._curFloorId)}},{key:"getFloorJson",value:function(e){for(var t=this.jsonData.data.Floors,n=0;n<t.length;n++)if(t[n].userData._id===e)return t[n];return null}},{key:"showFloor",value:function(e){this.root.remove(this.building);for(var t=0;t<this.floors.length;t++)this.floors[t].userData._id===e?(this.floors[t].position.set(0,0,0),this.root.add(this.floors[t])):this.root.remove(this.floors[t]);this._curFloorId=e}},{key:"showAllFloors",value:function(){this.root.add(this.building);for(var e=0;e<this.floors.length;e++)this.floors[e].position.set(0,0,e*this.floors[e].userData.height*4),this.root.add(this.floors[e]);return this.building.scale.set(1,1,4),this._curFloorId=0,this.root}}]),e}(),j={scene:{width:window.innerWidth,height:window.innerHeight,container:document.body},camera:{position:{x:0,y:100,z:100}},renderer:{clearColor:"#F2F2F2"},SCALE:.1},k={color:"#E0E0E0",opacity:1,transparent:!1},F=5,O=80,D={color:"#000000",opacity:.1,transparent:!0,depthTest:!1},E=600,A=500,_={color:"#5C4433",opacity:.5,transparent:!0,linewidth:2},C=30;var x=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"setBuilding",value:function(e){var t=D,n=E,r=A,o=new h.r(e),a={amount:r,bevelEnabled:!1},i=new h.d(o,a),s=new h.k(t),l=new h.j(i,s);return l.position.set(0,0,-n),l.name="building",l}},{key:"setFloor",value:function(e){var t=E,n=k,r=F,o=new h.r(e),a=new h.s(o),i=new h.k(n),s=new h.j(a,i);return s.position.set(0,0,-(t+r)),s.name="floor",s}},{key:"setModel",value:function(e,t){var n=E,r=new h.r(e),o=new h.d(r,{depth:30,bevelEnabled:!1}),a=new h.l(function(e,t){var n;if(!t)switch(e){case 100:return{color:"#F2F2F2",opacity:.8,transparent:!0};case 300:return{color:"#AAAAAA",opacity:.7,transparent:!0};case 400:return{color:"#D3D3D3",opacity:.7,transparent:!0}}switch(t){case 101:n={color:"#1f77b4",opacity:.7,transparent:!0};break;case 102:n={color:"#aec7e8",opacity:.7,transparent:!0};break;case 103:n={color:"#ffbb78",opacity:.7,transparent:!0};break;case 104:n={color:"#98df8a",opacity:.7,transparent:!0};break;case 105:n={color:"#bcbd22",opacity:.7,transparent:!0};break;case 106:n={color:"#2ca02c",opacity:.7,transparent:!0};break;case 107:n={color:"#dbdb8d",opacity:.7,transparent:!0};break;case 108:n={color:"#EE8A31",opacity:.7,transparent:!0};break;case 109:n={color:"#8c564b",opacity:.7,transparent:!0};break;default:n={color:"#c49c94",opacity:.7,transparent:!0}}return n}(parseInt(t.Type),t.Category)),i=new h.j(o,a);return i.position.set(0,0,-n),i.type="solidroom",i}},{key:"setWire",value:function(e){var t=E,n=_,r=C,o=new h.r(e).createPointsGeometry(0),a=new h.g(n),i=new h.f(o,a);return i.position.set(0,0,-(t-r)),i}}]),e}(),P=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(b.a)(this,e),this.tl=void 0,this.br=void 0,this.tl=[t,n],this.br=[r,o]};function S(e){var t=new P;if(e.length<2)return t;for(var n=9999999,r=9999999,o=-9999999,a=-9999999,i=0;i<e.length-1;i+=2)e[i]>o&&(o=e[i]),e[i]<n&&(n=e[i]),e[i+1]>a&&(a=e[i+1]),e[i+1]<r&&(r=e[i+1]);return t.tl=[n,r],t.br=[o,a],t}var I=function(e){Object(w.a)(n,e);var t=Object(m.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(g.a)(n,[{key:"load",value:function(e,t){var n=this;fetch(e).then((function(e){return e.json()})).then((function(e){var r=n.parse(e);t(r)}))}},{key:"parse",value:function(e){return new N(e).parse()}}]),n}(h.h),N=function(){function e(t){Object(b.a)(this,e),this.json=void 0,this.geometry=void 0,this.mall=void 0,this.json=t,this.geometry=new x,this.mall=new y}return Object(g.a)(e,[{key:"parse",value:function(){for(var e,t,n=O,r=j.SCALE,o=0;o<this.json.data.Floors.length;o++){var a=this.json.data.Floors[o];a.rect=S(a.Outline[0][0]),t=this._parsePoints(a.Outline[0][0]);var i=new h.m;i.userData.height=n,i.add(this.geometry.setFloor(t)),i.userData.points=[],i.userData._id=a._id,i.name="floorGroup",i.position.z=0,this.mall.floors.push(i);for(var s=0;s<a.FuncAreas.length;s++){var l=a.FuncAreas[s];l.rect=S(l.Outline[0][0]),t=this._parsePoints(l.Outline[0][0]),i.add(this.geometry.setModel(t,l));var c=l.Center;i.userData.points.push({name:l.Name,type:l.Type,position:new h.w(c[0]*r,n*r,-c[1]*r)})}for(var u=0;u<a.PubPoint.length;u++){var d=a.PubPoint[u],f=this._parsePoints(d.Outline[0][0])[0];i.userData.points.push({name:d.Name,type:d.Type,position:new h.w(f.x*r,n*r,-f.y*r)})}}return e=this.json.data.building,t=this._parsePoints(e.Outline[0][0]),this.mall.FrontAngle=e.FrontAngle,t.length>0&&(this.mall.building=this.geometry.setBuilding(t)),this.mall.root=new h.m,this.mall.root.scale.set(r,r,r),this.mall.root.rotateOnAxis(new h.w(1,0,0),-Math.PI/2),this.mall.root.name="mall",this.mall}},{key:"_parsePoints",value:function(e){for(var t=[],n=0;n<e.length;n+=2){var r=new h.v(e[n],e[n+1]);if(n>0){var o=t[t.length-1];r.x===o.x&&r.y===o.y||t.push(r)}else t.push(r)}return t}}]),e}(),z=I,B=n(15),L=function(){function e(){Object(b.a)(this,e),this.store=q,this.scene=q.getState().scene,this.camera=q.getState().camera,this.renderer=q.getState().renderer,this.orbit=q.getState().orbit}return Object(g.a)(e,[{key:"createLight",value:function(){var e=new h.a(16777215,.2);this.scene.add(e);var t=new h.e(16777215,0,.9);this.scene.add(t)}},{key:"createAxes",value:function(){var e=new h.b(50);this.scene.add(e)}},{key:"createOrbit",value:function(){this.orbit=new B.a(this.camera,this.renderer.domElement)}}]),e}(),M=new h.p,W=new h.v,H=[];var T=function(){var e=j.camera,t=j.scene,n=j.renderer,a=v(Object(r.useCallback)((function(r){var o=e.position,a=o.x,i=o.y,s=o.z,l=t.width,c=t.height,u=t.container,h=n.clearColor,d=r.scene,f=r.camera,p=r.renderer,v=r.orbit;return f.position.set(a,i,s),p.setSize(l,c),p.setClearColor(h),u.appendChild(p.domElement),{scene:d,camera:f,renderer:p,orbit:v}}),[t,e,n])),i=a.scene,s=a.camera,l=a.renderer,c=a.orbit;Object(r.useEffect)((function(){u()}));var u=function(){d("./data/map1.json"),f(),p(),h()},h=function e(){requestAnimationFrame(e),c&&c.update(),l.render(i,s)},d=function(e){(new z).load(e,(function(e){i.add(e.root),i.userData.mall=e,e.showAllFloors(),H=function(e,t){var n=[];return function e(r){return r.name===t&&n.push(r),!r.children||r.children.length<=0?null:(r.children.forEach((function(t){e(t)})),n)}(e)}(e.root,"floor")}))},f=function(){var e=new L;e.createLight(),e.createAxes(),e.createOrbit()},p=function(){window.addEventListener("resize",b),window.addEventListener("click",g)},b=function(){var e=t.width,n=t.height;s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),l.setSize(e,n)},g=function(e){var n=t.container;if(W.x=e.clientX/n.clientWidth*2-1,W.y=-e.clientY/n.clientHeight*2+1,M.setFromCamera(W,s),H.length){var r=M.intersectObjects(H);r.length&&w(r)}},w=function(e){i.getObjectByName("mall").children.forEach((function(t){t.userData._id!==e[0].object.parent.userData._id?t.visible=!1:t.visible=!0}))};return o.a.createElement("div",{id:"canvas"})};var J=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(T,null))},q=(n(23),Object(s.a)(c,d));i.a.render(o.a.createElement(p.Provider,{value:q},o.a.createElement(J,null)),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.8b2a3ae2.chunk.js.map